{% comment %}
  Simplified product media gallery for Screenlux
  Renders product images in a slider with navigation arrows and counter
{% endcomment %}

{%- liquid
  assign media_count = product.media.size
  if media_count == 0
    assign media_count = 1
  endif
-%}

<media-gallery
  id="MediaGallery-{{ section.id }}"
  role="region"
  aria-label="{{ 'products.product.media.gallery_viewer' | t }}"
  data-desktop-layout="stacked"
>
  <div id="GalleryStatus-{{ section.id }}" class="visually-hidden" role="status"></div>

  <slider-component id="GalleryViewer-{{ section.id }}" class="slider-mobile-gutter">
    <a class="skip-to-content-link button visually-hidden" href="#ProductInfo-{{ section.id }}">
      {{ 'accessibility.skip_to_product_info' | t }}
    </a>

    <ul
      id="Slider-Gallery-{{ section.id }}"
      class="product__media-list contains-media grid grid--peek list-unstyled slider slider--mobile slider--tablet-up slider--desktop"
      role="list"
    >
      {%- for media in product.media -%}
        <li
          id="Slide-{{ section.id }}-{{ media.id }}"
          class="product__media-item grid__item slider__slide{% if forloop.first %} is-active{% endif %}"
          data-media-id="{{ section.id }}-{{ media.id }}"
        >
          <div class="product__media media media--transparent">
            {%- if media.media_type == 'image' -%}
              <img
                srcset="
                  {%- if media.width >= 165 -%}{{ media | image_url: width: 165 }} 165w,{%- endif -%}
                  {%- if media.width >= 360 -%}{{ media | image_url: width: 360 }} 360w,{%- endif -%}
                  {%- if media.width >= 533 -%}{{ media | image_url: width: 533 }} 533w,{%- endif -%}
                  {%- if media.width >= 720 -%}{{ media | image_url: width: 720 }} 720w,{%- endif -%}
                  {%- if media.width >= 940 -%}{{ media | image_url: width: 940 }} 940w,{%- endif -%}
                  {%- if media.width >= 1066 -%}{{ media | image_url: width: 1066 }} 1066w,{%- endif -%}
                  {{ media | image_url }} {{ media.width }}w
                "
                src="{{ media | image_url: width: 533 }}"
                sizes="(min-width: 750px) calc((100vw - 11.5rem) / 2), calc(100vw - 4rem)"
                loading="{% if forloop.first %}eager{% else %}lazy{% endif %}"
                width="{{ media.width }}"
                height="{{ media.height }}"
                alt="{{ media.alt | escape }}"
                class="gallery-image"
              >
            {%- else -%}
              {{ media | media_tag: image_size: '720x', class: 'gallery-media', loading: 'lazy' }}
            {%- endif -%}
          </div>
        </li>
      {%- endfor -%}
    </ul>

    {%- if media_count > 1 -%}
      <div class="slider-buttons no-js-hidden quick-add-hidden">
        <button
          type="button"
          class="slider-button slider-button--prev"
          name="previous"
          aria-label="{{ 'general.slider.previous_slide' | t }}"
          aria-controls="Slider-Gallery-{{ section.id }}"
        >
          <svg aria-hidden="true" focusable="false" class="icon icon-caret" viewBox="0 0 10 6">
            <path fill-rule="evenodd" clip-rule="evenodd" d="M9.354.646a.5.5 0 00-.708 0L5 4.293 1.354.646a.5.5 0 00-.708.708l4 4a.5.5 0 00.708 0l4-4a.5.5 0 000-.708z" fill="currentColor"/>
          </svg>
        </button>
        <div class="slider-counter caption">
          <span class="slider-counter--current">1</span>
          <span aria-hidden="true"> / </span>
          <span class="visually-hidden">{{ 'general.slider.of' | t }}</span>
          <span class="slider-counter--total">{{ media_count }}</span>
        </div>
        <button
          type="button"
          class="slider-button slider-button--next"
          name="next"
          aria-label="{{ 'general.slider.next_slide' | t }}"
          aria-controls="Slider-Gallery-{{ section.id }}"
        >
          <svg aria-hidden="true" focusable="false" class="icon icon-caret" viewBox="0 0 10 6">
            <path fill-rule="evenodd" clip-rule="evenodd" d="M9.354.646a.5.5 0 00-.708 0L5 4.293 1.354.646a.5.5 0 00-.708.708l4 4a.5.5 0 00.708 0l4-4a.5.5 0 000-.708z" fill="currentColor"/>
          </svg>
        </button>
      </div>
    {%- endif -%}
  </slider-component>
</media-gallery>
