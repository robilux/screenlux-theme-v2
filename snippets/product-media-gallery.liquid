{% comment %}
  Simplified product media gallery for Screenlux
  Renders product images in a slider with navigation arrows and counter
{% endcomment %}

{%- liquid
  assign media_count = 0
  for media in product.media
    if media.media_type == 'image'
      assign media_count = media_count | plus: 1
    endif
  endfor
  if media_count == 0
    assign media_count = 1
  endif
  comment
    Add 1 for the SVG configurator slide
  endcomment
  assign media_count = media_count | plus: 1
-%}

<media-gallery
  id="MediaGallery-{{ section.id }}"
  role="region"
  aria-label="{{ 'products.product.media.gallery_viewer' | t }}"
  data-desktop-layout="stacked"
>
  <div id="GalleryStatus-{{ section.id }}" class="visually-hidden" role="status"></div>

  <slider-component id="GalleryViewer-{{ section.id }}" class="slider-mobile-gutter">
    <a class="skip-to-content-link button visually-hidden" href="#ProductInfo-{{ section.id }}">
      {{ 'accessibility.skip_to_product_info' | t }}
    </a>

    <ul
      id="Slider-Gallery-{{ section.id }}"
      class="product__media-list contains-media grid grid--peek list-unstyled slider slider--mobile slider--tablet-up slider--desktop"
      role="list"
    >
      {%- assign slide_index = 0 -%}
      {%- for media in product.media -%}
        {%- if media.media_type == 'image' -%}
          {%- assign slide_index = slide_index | plus: 1 -%}
          <li
            id="Slide-{{ section.id }}-{{ media.id }}"
            class="product__media-item grid__item slider__slide{% if forloop.first %} is-active{% endif %}"
            data-media-id="{{ section.id }}-{{ media.id }}"
          >
            <div class="product__media media media--transparent">
              <img
                srcset="
                  {%- if media.width >= 165 -%}{{ media | image_url: width: 165 }} 165w,{%- endif -%}
                  {%- if media.width >= 360 -%}{{ media | image_url: width: 360 }} 360w,{%- endif -%}
                  {%- if media.width >= 533 -%}{{ media | image_url: width: 533 }} 533w,{%- endif -%}
                  {%- if media.width >= 720 -%}{{ media | image_url: width: 720 }} 720w,{%- endif -%}
                  {%- if media.width >= 940 -%}{{ media | image_url: width: 940 }} 940w,{%- endif -%}
                  {%- if media.width >= 1066 -%}{{ media | image_url: width: 1066 }} 1066w,{%- endif -%}
                  {{ media | image_url }} {{ media.width }}w
                "
                src="{{ media | image_url: width: 533 }}"
                sizes="(min-width: 750px) calc((100vw - 11.5rem) / 2), calc(100vw - 4rem)"
                loading="{% if forloop.first %}eager{% else %}lazy{% endif %}"
                width="{{ media.width }}"
                height="{{ media.height }}"
                alt="{{ media.alt | escape }}"
                class="gallery-image"
              >
            </div>
          </li>

          {%- comment -%} Insert SVG Configurator after the first image {%- endcomment -%}
          {%- if is_configurator and forloop.first -%}
            <li
              id="Slide-{{ section.id }}-svg-configurator"
              class="product__media-item grid__item slider__slide"
              data-media-id="{{ section.id }}-svg-configurator"
              data-svg-configurator="true"
            >
              <div class="product__media media media--transparent">
                {% render 'svg-screen-configurator' %}
              </div>
            </li>
          {%- endif -%}
        {%- endif -%}
      {%- endfor -%}
    </ul>

    {%- if media_count > 1 -%}
      <div class="slider-buttons no-js-hidden quick-add-hidden">
        <button
          type="button"
          class="slider-button slider-button--prev"
          name="previous"
          aria-label="{{ 'general.slider.previous_slide' | t }}"
          aria-controls="Slider-Gallery-{{ section.id }}"
        >
          <svg aria-hidden="true" focusable="false" class="icon icon-caret" viewBox="0 0 10 10">
            <path d="M6.5 1.5L3 5l3.5 3.5" stroke="currentColor" stroke-width="1.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
        <button
          type="button"
          class="slider-button slider-button--next"
          name="next"
          aria-label="{{ 'general.slider.next_slide' | t }}"
          aria-controls="Slider-Gallery-{{ section.id }}"
        >
          <svg aria-hidden="true" focusable="false" class="icon icon-caret" viewBox="0 0 10 10">
            <path d="M3.5 1.5L7 5l-3.5 3.5" stroke="currentColor" stroke-width="1.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </div>
      <div class="slider-counter caption">
        <span class="slider-counter--current">1</span>
        <span aria-hidden="true"> / </span>
        <span class="visually-hidden">{{ 'general.slider.of' | t }}</span>
        <span class="slider-counter--total">{{ media_count }}</span>
      </div>
    {%- endif -%}
  </slider-component>

  {%- if media_count > 1 -%}
    <div class="thumbnail-slider" role="list">
      {%- for media in product.media -%}
        {%- if media.media_type == 'image' -%}
          <button
            class="thumbnail{% if forloop.first %} active{% endif %}"
            aria-label="{{ 'products.product.media.load_image' | t }}: {{ forloop.index }}"
            data-target="{{ section.id }}-{{ media.id }}"
            data-media-id="{{ section.id }}-{{ media.id }}"
            type="button"
          >
            <img
              src="{{ media | image_url: width: 120 }}"
              alt="{{ media.alt | escape }}"
              width="72"
              height="54"
              loading="lazy"
            >
          </button>

          {%- comment -%} SVG Configurator Thumbnail after first image {%- endcomment -%}
          {%- if is_configurator and forloop.first -%}
            <button
              class="thumbnail thumbnail--configurator"
              aria-label="Screen Configurator Preview"
              data-target="{{ section.id }}-svg-configurator"
              data-media-id="{{ section.id }}-svg-configurator"
              type="button"
            >
              <div class="thumbnail-configurator-icon">
                <svg
                  id="configurator-thumbnail-svg"
                  width="40"
                  height="30"
                  viewBox="0 0 40 30"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <rect data-thumb-part="cassette" x="0.5" y="0.5" width="39" height="5" rx="2" fill="#FFFFFF" stroke="#E6E6E6" stroke-width="1"/>
                  <rect data-thumb-part="solar-panel" x="25.5" y="1.5" width="10" height="3" rx="0.5" fill="#373F47" style="display:none;"/>
                  <rect data-thumb-part="rail-left" x="0.5" y="5.5" width="3" height="24" fill="#FFFFFF" stroke="#E6E6E6" stroke-width="1"/>
                  <rect data-thumb-part="rail-right" x="36.5" y="5.5" width="3" height="24" fill="#FFFFFF" stroke="#E6E6E6" stroke-width="1"/>
                  <rect data-thumb-part="fabric" x="3.5" y="5.5" width="33" height="22" fill="#E6E6E6"/>
                  <rect data-thumb-part="bottom-bar" x="3.5" y="27.5" width="33" height="2" fill="#FFFFFF" stroke="#E6E6E6" stroke-width="1"/>
                </svg>
              </div>
            </button>
          {%- endif -%}
        {%- endif -%}
      {%- endfor -%}
    </div>
  {%- endif -%}
</media-gallery>
